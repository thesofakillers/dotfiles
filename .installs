#!/usr/bin/env bash
OS_NAME="$(uname -s)"

# {{{ general
mkdir -p "$HOME/bin"
export PATH="$HOME/bin:$PATH"
# }}}

# {{{ fzf
if command -v rg > /dev/null 2>&1; then
  export FZF_DEFAULT_COMMAND='rg --files --hidden --glob "!.git/*"'
elif command -v ag > /dev/null 2>&1; then
  export FZF_DEFAULT_COMMAND='ag --hidden --ignore .git -g ""'
fi
# }}}

# {{{ python poetry
export PATH="$HOME/.local/bin:$PATH"
# }}}

# {{{ node version manager (https://github.com/tj/n)
# using curl -L https://bit.ly/n-install | bash
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
# Hint Codex that Bun manages the install so update prompts use bun.
export npm_execpath="${npm_execpath:-$BUN_INSTALL/bin/bun}"
export npm_config_user_agent="${npm_config_user_agent:-bun/1}"

export N_PREFIX="$HOME/n"
[[ :$PATH: == *":$N_PREFIX/bin:"* ]] || PATH+=":$N_PREFIX/bin" # Added by n-install (see http://git.io/n-install-repo).
# }}}

# {{{ LaTeX
if [[ "$OS_NAME" == "Darwin" ]]; then
  export PATH="/Library/TeX/Distributions/.DefaultTeX/Contents/Programs/texbin:$PATH"
fi
# }}}

# {{{ go
export GOPATH="$HOME/go"
export PATH="$GOPATH/bin:$PATH"
# }}}

# {{{ macports
if [[ "$OS_NAME" == "Darwin" ]]; then
  # MacPorts Installer addition on 2023-02-01_at_12:25:54: adding an appropriate PATH variable for use with MacPorts.
  export PATH="/opt/local/bin:/opt/local/sbin:$PATH"
  # Finished adapting your PATH environment variable for use with MacPorts.
fi
# }}}

# {{{ tree
alias tree='tree -I "node_modules|\.git|\.DS_Store|__pycache__|venv|\.venv|\.mypy_cache|\.pytest_cache|\.tox|\.vscode|\.idea|\.cache|\.ipynb_checkpoints"'
# }}}

# {{{ homebrew
if command -v brew > /dev/null 2>&1; then
  eval "$(brew shellenv)"
  export HOMEBREW_NO_AUTO_UPDATE=1

  if ! command -v python > /dev/null 2>&1 && command -v python3 > /dev/null 2>&1; then
    ln -sf "$(command -v python3)" "$HOME/bin/python"
  fi

  if ! command -v pip > /dev/null 2>&1 && command -v pip3 > /dev/null 2>&1; then
    ln -sf "$(command -v pip3)" "$HOME/bin/pip"
  fi
fi
# }}}

# {{{ LMStudio
# Added by LM Studio CLI (lms)
export PATH="$PATH:$HOME/.cache/lm-studio/bin"
# End of LM Studio CLI section
# }}}

# {{{ Docker
if [[ "$OS_NAME" == "Darwin" ]]; then
  export PATH="/Applications/Docker.app/Contents/Resources/bin:$PATH"
fi
# }}}

# {{{ psql (postgresql)
if [ -d "/opt/homebrew/opt/libpq/bin" ]; then
  export PATH="/opt/homebrew/opt/libpq/bin:$PATH"

  # For compilers to find libpq you may need to set:
  export LDFLAGS="-L/opt/homebrew/opt/libpq/lib"
  export CPPFLAGS="-I/opt/homebrew/opt/libpq/include"

  # For pkg-config to find libpq you may need to set:
  export PKG_CONFIG_PATH="/opt/homebrew/opt/libpq/lib/pkgconfig"
fi
# }}}

# {{{ fd on Debian/Ubuntu
if command -v fdfind > /dev/null 2>&1 && ! command -v fd > /dev/null 2>&1; then
  alias fd='fdfind'
fi
# }}}
